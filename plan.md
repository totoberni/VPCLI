# CLI Implementation Plan

**Objective:** This document provides a detailed, step-by-step technical guide for building the `financial_strategist_cli` tool.

## Phase 1: Project Scaffolding & Setup

This phase establishes the foundational structure and environment for the project.

### **Step 1.1: Directory Structure**

A clean directory structure is essential for maintainability. From your chosen development folder, create the project root and its initial subdirectories.

```bash
# Create the main project folder
mkdir financial_strategist_cli
cd financial_strategist_cli

# Create source code and asset folders
mkdir src
mkdir assets
```
-   `src/`: Will house all Python source code modules (`main.py`, `engine.py`, `display.py`).
-   `assets/`: Will store the required input artifacts (`.pkl` and `.html` files) generated by the Phase 6 notebook.

### **Step 1.2: Virtual Environment**

We must use a virtual environment to isolate project dependencies and avoid conflicts with other Python projects.

1.  **Creation:** From the project root (`financial_strategist_cli/`), run:
    ```bash
    python -m venv .venv
    ```
2.  **Activation:**
    -   **Windows (PowerShell):** `.\.venv\Scripts\Activate.ps1`
    -   **Windows (CMD):** `.\.venv\Scripts\activate.bat`
    -   **macOS/Linux:** `source .venv/bin/activate`

You will need to activate this environment every time you work on the project.

## Phase 2: Dependency Management & Installation

We will use the modern `pyproject.toml` standard for a declarative and reproducible dependency setup.

### **Step 2.1: Create `pyproject.toml`**

Create this file in the project's root directory. It will define our project's metadata and, most importantly, its dependencies.

### **Step 2.2: Define Dependencies and Scripts**

Add the following content to `pyproject.toml`.

```toml
[project]
name = "financial_strategist_cli"
version = "0.1.0"
description = "A CLI tool for providing hybrid predictive and historical investment strategies."
dependencies = [
    "typer[all] >= 0.9.0", # For a rich CLI experience with autocompletion and colors.
    "rich >= 13.0.0",     # For beautiful formatting of tables and prompts in the console.
    "pandas >= 2.0.0",    # For data manipulation.
    "xgboost >= 2.0.0",   # Required to load and run the trained models.
    "scikit-learn >= 1.3.0", # Required for loading models and the DummyClassifier.
]

[project.scripts]
strategy-report = "src.main:app"
```
**Architectural Decisions:**
-   **CLI Framework:** `Typer` is chosen for its modern, type-hint-driven API, which simplifies creating clean, robust, and self-documenting CLI commands. The `[all]` extra ensures `shellingham` is installed for automatic shell completion detection.
-   **UI/UX Library:** `rich` is the de facto standard for building user-friendly and visually appealing console applications. Its integration with `Typer` is seamless.
-   **Script Entry Point:** The `[project.scripts]` table creates a direct link between the command `strategy-report` and the `app` object within our `src/main.py` file.

### **Step 2.3: Install Dependencies**

With the virtual environment activated, run this command from the project root. This tells `pip` to install the current directory as a package in "editable" mode (`-e`) and pull in all dependencies defined in `pyproject.toml`.

```bash
pip install -e .
```

## Phase 3: CLI Prototype - Interactive Shell

This phase focuses on creating the initial user-facing script that handles user input but does not yet perform any analysis.

### **Step 3.1: Create `src/main.py`**

This will be the main entry point. We will structure it to be clear and extensible.

**Syntax Pattern Example (`src/main.py`):**

```python
import typer
from rich.console import Console
from rich.prompt import Prompt

# Create a single Typer app instance. This will manage all our commands.
app = typer.Typer(
    name="strategy-report",
    help="A CLI for generating hybrid predictive and historical investment strategies.",
    add_completion=False # We can enable this later for a more advanced setup.
)

# Use a single Console instance for all printing to ensure consistent styling.
console = Console()

# --- Application Constants ---
# Storing choices in data structures makes the code easier to maintain and test.
COMPANIES = {
    "1": "Apple (AAPL)",
    "2": "NVIDIA (NVDA)",
    "3": "Google (GOOGL)"
}
PREDICTIVE_HORIZONS = ["1M", "3M", "6M", "12M", "18M", "24M", "36M"]
HISTORICAL_HORIZONS = ["48M", "60M", "72M", "84M"]

@app.command(
    help="Run the interactive strategy report generator."
)
def run():
    """
    The main interactive command that guides the user through selecting a
    company and investment horizon.
    """
    console.print("\n[bold cyan]Welcome to the Financial Strategy Engine![/bold cyan]\n")

    # --- 1. Company Selection ---
    company_prompt_text = "\n".join([f"  [bold yellow]{key}[/bold yellow]: {name}" for key, name in COMPANIES.items()])
    console.print("[bold]First, what company do you want to investigate?[/bold]")
    console.print(company_prompt_text)
    company_idx = Prompt.ask("Enter selection", choices=list(COMPANIES.keys()), default="2")
    selected_company_name = COMPANIES[company_idx]
    # Extract ticker, e.g., "AAPL" from "Apple (AAPL)"
    selected_ticker = selected_company_name.split('(')[-1].replace(')','')

    # --- 2. Horizon Selection ---
    console.print("\n[bold]Next, what is your investment period?[/bold]")
    console.print("\n[bold magenta]--- Predictive Recommendations (1M-36M) ---[/bold magenta]")
    console.print("  " + " | ".join(PREDICTIVE_HORIZONS))
    console.print("\n[bold magenta]--- Historical Analysis (48M-84M) ---[/bold magenta]")
    console.print("  " + " | ".join(HISTORICAL_HORIZONS))

    all_horizons = PREDICTIVE_HORIZONS + HISTORICAL_HORIZONS
    selected_horizon = Prompt.ask("\nEnter horizon (e.g., '12M', '48M')", choices=all_horizons, default="12M")

    # --- 3. Final Confirmation (Prototype Logic) ---
    console.print("\n" + "="*50)
    console.print("[bold green]Query Received![/bold green]")
    console.print(f"  [bold]Company:[/bold] {selected_company_name}")
    console.print(f"  [bold]Ticker:[/bold] {selected_ticker}")
    console.print(f"  [bold]Horizon:[/bold] {selected_horizon}")
    console.print("="*50)
    console.print("\n[italic]Note: This is a prototype. Full report generation will be implemented in the next phase.[/italic]")


# It's best practice to guard the app runner for when the script is run directly.
if __name__ == "__main__":
    app()
```

### **Step 3.2: Verification**

1.  Run the application from the project root directory:
    ```bash
    strategy-report run
    ```
2.  Interact with the prompts. The tool should ask for a company, then a horizon, and finally print a summary of your selections.
3.  Check the help message, which is automatically generated by Typer:
    ```bash
    strategy-report run --help
    ```
This completes the setup of the functional CLI prototype. The next steps will involve loading the data assets and wiring the user's selections to the appropriate engine (predictive or historical).